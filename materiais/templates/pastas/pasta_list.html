{% extends 'base.html' %}

{% block title %}Trilhas{% endblock %}

{% block links %}

{% endblock %}

{% block content %}

<section class="page-header">
    <div class="container">
        <h1 class="page-title">Trilhas disponíveis</h1>
        <p class="page-subtitle">Cursos aos quais você já tem acesso</p>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="courses-grid" id="courses-grid">
            {% for item in pastas_com_criadores %}
            <div class="course-card{% if forloop.counter > 10 %} d-none extra-course{% endif %}">
                <div class="course-image">
                    <div class="placeholder-image"></div>
                </div>
                <div class="course-content">
                    <h3 class="course-title">
                        <a href="{% url 'detail-pasta' item.pasta.pk %}">{{ item.pasta.nome }}</a>
                    </h3>
                    <p class="course-instructor">Criada por {{ item.criador_nome_completo }}</p>
                    <div class="course-meta">
                        <span class="course-duration">{{ item.pasta.carga_horaria|default:"Carga horária não informada" }}</span>
                        <span class="course-level">
                            {% if item.setores %}{{ item.setores|join:", " }}{% else %}Todos os setores{% endif %}
                        </span>
                    </div>
                    <p class="course-description">{{ item.pasta.descricao|default:"Sem descrição disponível." }}</p>
                    <a href="{% url 'detail-pasta' item.pasta.pk %}" class="btn btn-secondary">Ver detalhes</a>
                </div>
            </div>
            {% empty %}
            <div class="text-center py-4">
                <p>Você ainda não está inscrito em nenhuma trilha.</p>
            </div>
            {% endfor %}
        </div>
        {% if pastas_com_criadores|length > 10 %}
        <div class="text-center mt-4 mb-3 w-100 d-flex justify-content-center">
            <button id="load-more" class="btn btn-primary">Ver mais</button>
        </div>
        {% endif %}
    </div>
</section>
    
{% endblock %}

{% block scripts %}
<script>
    (function() {
        const batchSize = 10;
        const courses = Array.from(document.querySelectorAll('.course-card'));
        const loadMoreBtn = document.getElementById('load-more');
        let visibleCount = batchSize;

        if (!loadMoreBtn) return;

        loadMoreBtn.addEventListener('click', function() {
            const hidden = courses.slice(visibleCount, visibleCount + batchSize);
            hidden.forEach(card => card.classList.remove('d-none', 'extra-course'));
            visibleCount += hidden.length;
            if (visibleCount >= courses.length) {
                loadMoreBtn.classList.add('d-none');
            }
        });
    })();
</script>
{% endblock %}
